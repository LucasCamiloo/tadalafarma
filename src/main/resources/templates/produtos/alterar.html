<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Alterar Produto - Tadalafarma</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <div class="page-container">
        <div class="header">
            <div>
                <h1>‚úèÔ∏è Alterar Produto</h1>
                <p class="subtitle">Editar informa√ß√µes do produto</p>
            </div>
            <a href="/produtos">‚Üê Voltar √† Lista</a>
        </div>

        <div th:if="${param.sucesso}" class="message success">
            <strong>‚úì Sucesso:</strong> <span th:text="${param.sucesso[0]}"></span>
        </div>

        <div th:if="${erro}" class="message error">
            <strong>‚ùå Erro:</strong> <span th:text="${erro}"></span>
        </div>
        
        <div th:if="${param.erro}" class="message error">
            <strong>‚ùå Erro:</strong> <span th:text="${param.erro[0]}"></span>
        </div>

        <div th:if="${isEstoquista}" class="role-info">
            <strong>‚ö†Ô∏è Modo Estoquista:</strong> Voc√™ pode alterar apenas a quantidade em estoque.
        </div>

        <div class="content-wrapper">
            <div class="form-container">
                <form method="post" th:action="@{/produtos/{id}/alterar(id=${produto.sequencialId})}" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="nome">üìù Nome do Produto *</label>
                        <input type="text" id="nome" name="nome" th:value="${produto.nome}" maxlength="200" th:disabled="${isEstoquista}" required>
                        <small>M√°ximo 200 caracteres</small>
                    </div>

                    <div class="form-group">
                        <label for="avaliacao">‚≠ê Avalia√ß√£o *</label>
                        <select id="avaliacao" name="avaliacao" th:disabled="${isEstoquista}" required>
                            <option value="">Selecione uma avalia√ß√£o...</option>
                            <option value="1.0" th:selected="${produto.avaliacao == 1.0}">‚≠ê 1.0</option>
                            <option value="1.5" th:selected="${produto.avaliacao == 1.5}">‚≠ê 1.5</option>
                            <option value="2.0" th:selected="${produto.avaliacao == 2.0}">‚≠ê‚≠ê 2.0</option>
                            <option value="2.5" th:selected="${produto.avaliacao == 2.5}">‚≠ê‚≠ê 2.5</option>
                            <option value="3.0" th:selected="${produto.avaliacao == 3.0}">‚≠ê‚≠ê‚≠ê 3.0</option>
                            <option value="3.5" th:selected="${produto.avaliacao == 3.5}">‚≠ê‚≠ê‚≠ê 3.5</option>
                            <option value="4.0" th:selected="${produto.avaliacao == 4.0}">‚≠ê‚≠ê‚≠ê‚≠ê 4.0</option>
                            <option value="4.5" th:selected="${produto.avaliacao == 4.5}">‚≠ê‚≠ê‚≠ê‚≠ê 4.5</option>
                            <option value="5.0" th:selected="${produto.avaliacao == 5.0}">‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê 5.0</option>
                        </select>
                        <small>De 1 a 5, variando de 0.5 em 0.5</small>
                    </div>

                    <div class="form-group">
                        <label for="descricaoDetalhada">üìÑ Descri√ß√£o Detalhada *</label>
                        <textarea id="descricaoDetalhada" name="descricaoDetalhada" maxlength="2000" th:disabled="${isEstoquista}" required th:text="${produto.descricaoDetalhada}"></textarea>
                        <small>M√°ximo 2000 caracteres</small>
                    </div>

                    <div class="form-group">
                        <label for="preco">üí∞ Pre√ßo do Produto *</label>
                        <input type="number" id="preco" name="preco" th:value="${produto.preco}" step="0.01" min="0.01" th:disabled="${isEstoquista}" required>
                        <small>Valor monet√°rio com 2 casas decimais</small>
                    </div>

                    <div class="form-group">
                        <label for="quantidadeEstoque">üì¶ Quantidade em Estoque *</label>
                        <input type="number" id="quantidadeEstoque" name="quantidadeEstoque" th:value="${produto.quantidadeEstoque}" min="0" required>
                        <small>Quantidade dispon√≠vel no estoque</small>
                    </div>

                    <div th:if="${isAdmin}">
                        <h3 style="margin-top: 30px; margin-bottom: 20px;">üñºÔ∏è Gerenciar Imagens</h3>
                        
                        <div th:if="${!imagens.empty}" style="margin-bottom: 30px;">
                            <h4 style="margin-bottom: 15px; color: var(--text-primary);">Imagens Atuais</h4>
                            <div class="current-images">
                                <div th:each="imagem : ${imagens}" class="image-item" style="position: relative;">
                                    <img th:src="${imagem.caminhoArquivo}" 
                                         th:alt="${imagem.nomeArquivoOriginal}"
                                         th:class="${imagem.imagemPrincipal} ? 'imagem-principal' : ''">
                                    <div th:if="${imagem.imagemPrincipal}" style="color: var(--primary-color); font-weight: 700; margin-top: 8px; font-size: 14px;">
                                        ‚≠ê FOTO PRINCIPAL
                                    </div>
                                    <div th:unless="${imagem.imagemPrincipal}" style="margin-top: 8px;">
                                        <form th:action="@{/produtos/{produtoId}/imagem/{imagemId}/principal(produtoId=${produto.sequencialId},imagemId=${imagem.id})}" 
                                              method="post" style="display: inline;">
                                            <button type="submit" class="btn-set-principal" 
                                                    onclick="return confirm('Deseja definir esta imagem como principal?')">
                                                ‚≠ê Definir como Principal
                                            </button>
                                        </form>
                                    </div>
                                    <div style="margin-top: 8px;">
                                        <input type="checkbox" name="imagensParaDeletar" th:value="${imagem.id}" th:id="'img-' + ${imagem.id}">
                                        <label th:for="'img-' + ${imagem.id}" style="font-weight: normal; cursor: pointer; color: var(--text-secondary);">üóëÔ∏è Deletar</label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div>
                            <h4 style="margin-bottom: 15px; color: var(--text-primary);">Adicionar Novas Imagens</h4>
                            <div class="image-upload" onclick="document.querySelector('input[name=novasImagens]').click()">
                                <input type="file" name="novasImagens" multiple accept="image/*" onchange="previewImages(this)">
                                <p>üì∏ Arraste ou clique para selecionar novas imagens</p>
                                <div class="image-preview" id="imagePreview"></div>
                            </div>
                        </div>
                    </div>

                    <div class="button-group">
                        <button type="submit" class="btn btn-success">‚úì Salvar Altera√ß√µes</button>
                        <a href="/produtos" class="btn btn-secondary">‚úï Cancelar</a>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        function previewImages(input) {
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = '';
            
            if (input.files) {
                Array.from(input.files).forEach((file, index) => {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.title = file.name;
                        preview.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                });
            }
        }
    </script>
</body>
</html>

